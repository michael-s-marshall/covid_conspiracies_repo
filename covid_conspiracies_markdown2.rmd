---
title: "covid_conspiracies_markdown2"
author: "Michael Marshall"
date: "21/10/2020"
output: github_document
---

## Loading Packages and Data

```{r, message = FALSE, warnings = FALSE}
pacman::p_load(tidyverse, stringr, ggridges, forcats, labelled, leaps,
               psych, corrr, cowplot, expss, haven, interplot,
               interactions, jtools,labelled, pscl, psych, 
               sjPlot, skimr)

load("COVID W1_W2_W3 Cleaned 2878.RData") # needs to be in your wd
```

## Rescaling variable

```{r}
## [rescale01] Function to rescale a variable from 0 to 1
rescale01 <- function(x, ...) {
  (x - min(x, ...)) / ((max(x, ...)) - min(x, ...))
}
```

## Summary and distribution of different COVID specific conspiracies

```{r, message = FALSE, warning = FALSE}
# plotting density of different covid conspiracies
df %>% 
  dplyr::select(W2_Conspiracy_Theory1:W2_Conspiracy_Theory5) %>% 
  gather(conspiracy_code, belief,
         W2_Conspiracy_Theory1:W2_Conspiracy_Theory5) %>%
  mutate(conspiracy_code = as.factor(conspiracy_code)) %>%
  filter(!conspiracy_code %in% c("W2_Conspiracy_Theory4",
                                 "W2_Conspiracy_Theory5")) %>% 
  ggplot(aes(x = belief, y = conspiracy_code, height = ..density..)) +
  geom_density_ridges(aes(rel_min_height = 0.005),
                      stat = "density",
                      fill = get_colors("CUD Bright",num.colors = 1)) +
  theme_nice() +
  scale_y_discrete(labels = c("Wuhan laboratory","Meat market","5G")) +
  labs(y = NULL, x = "Belief scale (0-100)",
       caption = "Distribution of origin theory belief") +
  theme(plot.caption = element_text(hjust = 0.61,
                                    face = "bold",
                                    size = 10),
        axis.title.x = element_text(size = 8,
                                    hjust = 0.5)
  )
```

```{r}
#pacman::p_load(patchwork)
df %>% 
  dplyr::select(W2_Conspiracy_Theory1:W2_Conspiracy_Theory5) %>% 
  gather(conspiracy_code, belief,
         W2_Conspiracy_Theory1:W2_Conspiracy_Theory5) %>%
  mutate(conspiracy_code = fct_recode(
    as.factor(conspiracy_code),
    "Wuhan laboratory" = "W2_Conspiracy_Theory1",
    "Meat market" = "W2_Conspiracy_Theory2",
    "5G" = "W2_Conspiracy_Theory3",
    "4" = "W2_Conspiracy_Theory4",
    "5" = "W2_Conspiracy_Theory5")
    ) %>%
  filter(!conspiracy_code %in% c("4","5")) %>% 
  mutate(
    order_var = ifelse(conspiracy_code == "Meat market", 1,
                       ifelse(conspiracy_code == "Wuhan laboratory",2,3))
  ) %>% 
  ggplot(aes(x = belief)) +
  geom_density(fill = get_colors("CUD Bright",num.colors = 1),
               alpha = 0.8) +
  theme_nice() +
  facet_wrap(~fct_reorder(conspiracy_code,order_var), 
             scales = "free_y", ncol = 1) +
  labs(y = "Density", 
       x = "Distribution of origin theory belief")
```


## Cleaning dataset

The following code filters down to just those observations that have completed the battery of questions relating to COVID specific conspiracies.  It also creates a tibble counting the missing observations, which can be useful to have as an object.  

```{r}
# filtering for completed dependent variable
conspiracies <- df %>% 
  filter(!is.na(W2_Conspiracy_Theory1) |
           !is.na(W2_Conspiracy_Theory2) |
           !is.na(W2_Conspiracy_Theory3) |
           !is.na(W2_Conspiracy_Theory3) |
           !is.na(W2_Conspiracy_Theory4) |
           !is.na(W2_Conspiracy_Theory5)) %>% 
  rename(W1_Housing_tenure = W1_Hosuing_tenure)

# function to count NAs
count_na <- function(x){
  sum(is.na(x))
}

conspiracies %>% 
  dplyr::select(W2_Conspiracy_Theory1:W2_Conspiracy_Theory5) %>% 
  map_int(count_na)

missing <- tibble(
  variable = names(conspiracies),
  NAs = conspiracies %>% map_int(count_na)
)

#View(missing)
```

The code below combines the two variables on the 2019 general election into a single variable that combines whether a respondent voted, and who they voted for.  It also turns the *preferred newspaper* variables into dummy variables, as they were previously coded as *1=Yes* and everything else as *NA*.  

```{r}

# making preferred newspaper dummy variable (i.e. replacing NA with 0)
na_to_zero <- function(x){
  x[is.na(x)] <- 0
  x <- as.numeric(x)
  return(x)
} 

paper_vars <- rep(str_c("W2_Newspaper_prefer",seq(1,11,1)))

conspiracies[paper_vars] <- conspiracies[paper_vars] %>% 
  map_df(na_to_zero)

conspiracies <- conspiracies %>% 
  mutate(
    red_top_tabloid = ifelse(
      W2_Newspaper_prefer3 == 1 | W2_Newspaper_prefer2 == 1 |
        W2_Newspaper_prefer7 == 1 | W2_Newspaper_prefer8 == 1 |
        W2_Newspaper_prefer9 == 1, 1, 0),
    mid_level_news = ifelse(
      W2_Newspaper_prefer1 == 1 | W2_Newspaper_prefer4 == 1, 1, 0),
    elite_news = ifelse(
      W2_Newspaper_prefer5 == 1 | W2_Newspaper_prefer6 == 1 |
        W2_Newspaper_prefer10 == 1 | 
        W2_Newspaper_prefer11 == 1, 1, 0)
  )

conspiracies %>% 
  count(red_top_tabloid, mid_level_news, elite_news)
```

```{r}
# Creating DVs
# [nat] nationalism
nat_keys <- list(nationalism = cs(W2_Nationalism1,W2_Nationalism2))
nat_test <- scoreItems(nat_keys, conspiracies, min = 1, max = 5)
head(nat_test$scores)
nat_test$alpha  # Scale alpha
conspiracies$nat <- rescale01(nat_test$scores, na.rm = TRUE)
conspiracies$nat <- c(conspiracies$nat)  # Ensure variable is numeric and not matrix class
describe(conspiracies$nat)
```

```{r}
## [imm.econ] Anti-immigrant sentiment - Economy 
table(conspiracies$W1_MigrantAttitudes1)
conspiracies$imm_econ <- rescale01(abs(
  conspiracies$W1_MigrantAttitudes1 - 11))

conspiracies %>% 
  dplyr::select(W1_MigrantAttitudes1, imm_econ) %>%
  correlate()

## [imm.res] Anti-immigrant sentiment - Resources
table(conspiracies$W1_MigrantAttitudes3)
conspiracies$imm_res <- rescale01(conspiracies$W1_MigrantAttitudes3)
conspiracies %>% 
  dplyr::select(W1_MigrantAttitudes3, imm_res) %>%
  correlate()

## [imm.cul] Anti-immigrant sentiment - Culture
table(conspiracies$W1_MigrantAttitudes2)
conspiracies$imm_cul <- rescale01(abs(
  conspiracies$W1_MigrantAttitudes2 - 11))

conspiracies %>% 
  dplyr::select(W1_MigrantAttitudes2, imm_cul) %>%
  correlate()
```

```{r}
# Right wing authoritarianism
rwa_keys <- list(rwa = cs(W1_Authoritarianism1_R,
                          W1_Authoritarianism2,
                          W1_Authoritarianism3,
                          W1_Authoritarianism4_R, 
                          W1_Authoritarianism5_R,
                          W1_Authoritarianism6))

rwa_test <- scoreItems(rwa_keys, conspiracies, min = 1, max = 5)
head(rwa_test$scores)
summary(rwa_test$alpha)  # Scale alpha
conspiracies$RWA <- rescale01(rwa_test$scores, na.rm = TRUE)
conspiracies$RWA <- c(conspiracies$RWA)  # Ensure variable is numeric and not matrix class

describe(conspiracies$RWA)
```

```{r}
## [SDO] Social Dominance Orientation
sdo_keys <- list(sdo = cs(W1_Social_Dominance1,
                          W1_Social_Dominance2_R,
                          W1_Social_Dominance3_R,
                          W1_Social_Dominance4,
                          W1_Social_Dominance5_R,
                          W1_Social_Dominance6, 
                          W1_Social_Dominance7,
                          W1_Social_Dominance8_R))
sdo_test <- scoreItems(sdo_keys, conspiracies, min = 1, max = 5)
head(sdo_test$scores)
summary(sdo_test$alpha)  # Scale alpha
conspiracies$SDO <- rescale01(sdo_test$scores, na.rm = TRUE)
conspiracies$SDO <- c(conspiracies$SDO)  # Ensure variable is numeric and not matrix class

summary(conspiracies$SDO)
```

```{r}
## [threat] Covid-19 related Threat
summary(conspiracies$W2_COVID19_anxiety)
conspiracies$threat <- rescale01(conspiracies$W2_COVID19_anxiety)
conspiracies %>% 
  dplyr::select(W2_COVID19_anxiety, threat) %>%
  correlate()
```

```{r}
## [right] Right-Wing political views
table(conspiracies$W1_Political_Scale)
conspiracies$right <- rescale01(conspiracies$W1_Political_Scale)
conspiracies %>% 
  dplyr::select(W1_Political_Scale, right) %>%
  correlate()
```

```{r}
## [soc.con] Social conservatism
table(conspiracies$W1_Political_Abortion_SSM)
conspiracies$soc_con <- rescale01(
  conspiracies$W1_Political_Abortion_SSM)
conspiracies %>% 
  dplyr::select(W1_Political_Abortion_SSM, soc_con) %>%
  correlate()
```

```{r}
## [fis.con] Fiscal conservatism
table(conspiracies$W1_Political_Fiscal)
conspiracies$fis_con <- rescale01(conspiracies$W1_Political_Fiscal)
conspiracies %>% 
  dplyr::select(W1_Political_Fiscal, fis_con) %>%
  correlate()
```

```{r}
## [age.c] Age (in years)
summary(conspiracies$W2_Age_year)
conspiracies$age_sc <- rescale01(conspiracies$W2_Age_year)
```

```{r}
# conspiracy ideation alpha
consp_keys <- list(consp = cs(W1_Conspiracy_1,
                          W1_Conspiracy_2,
                          W1_Conspiracy_3,
                          W1_Conspiracy_4,
                          W1_Conspiracy_5))
consp_test <- scoreItems(consp_keys, conspiracies, min = 1, max = 11)
head(consp_test$scores)
consp_test$alpha  # Scale alpha

cor(consp_test$scores, conspiracies$W1_Conspiracy_Total)
```

```{r}
# uncertainty alpha
iou_keys <- list(iou = cs(W2_IOU1, W2_IOU2,W2_IOU3, W2_IOU4,
                          W2_IOU5, W2_IOU5,W2_IOU6,W2_IOU7,
                          W2_IOU7,W2_IOU8,W2_IOU9,W2_IOU10,
                          W2_IOU11,W2_IOU12))
iou_test <- scoreItems(iou_keys, conspiracies, min = 1, max = 5)
head(iou_test$scores)
iou_test$alpha  # Scale alpha

cor(iou_test$scores, conspiracies$W2_IOU_Total)
```

```{r}
# paranoia alpha
par_keys <- list(par = cs(W2_Paranoia1,
                        W2_Paranoia2,
                        W2_Paranoia3, W2_Paranoia4, W2_Paranoia5))
par_test <- scoreItems(par_keys, conspiracies, min = 1, max = 5)
head(par_test$scores)
par_test$alpha  # Scale alpha

cor(par_test$scores, conspiracies$W2_Paranoia_Total)
```

```{r}
# dai alpha
dai_keys <- list(dai = cs(W2_DAI1,W2_DAI2,W2_DAI3,W2_DAI4,W2_DAI5,
                        W2_DAI6,W2_DAI7,W2_DAI8,W2_DAI9,W2_DAI10,
                        W2_DAI11, W2_DAI12, W2_DAI13,W2_DAI14,
                        W2_DAI15,W2_DAI16,W2_DAI17))
dai_test <- scoreItems(dai_keys, conspiracies, min = 1, max = 5)
head(dai_test$scores)
dai_test$alpha  # Scale alpha

cor(dai_test$scores, conspiracies$W2_DAI_Total)
```


```{r}
factors <- c("W1_Ethnicity","W1_C19_Infected","W1_BornUK","W1_EURef",
             "W2_Gender_binary","W2_Living_alone","W2_Employment",
             "W1_Education_binary","W1_Housing_tenure")
```

```{r}
# turning the above list into factors with the levels as the spss labels
#for(i in seq_along(conspiracies[factors])){
#  conspiracies[factors][,i] <- to_factor(
#    conspiracies[factors][,i], nolabel_to_na = TRUE)
#}
```

```{r}
# turning to factors
conspiracies[factors] <- conspiracies[factors] %>% 
  map_df(as.factor)
```

```{r}
# Making a binary for each CRT scale, baseline = incorrect answer
conspiracies$CRT1 <- ifelse(
  to_factor(conspiracies$W1_CRT1) == "5 pence", 1, 0
)

conspiracies$CRT2 <- ifelse(
  to_factor(conspiracies$W1_CRT2) == "5 minutes", 1, 0
)

conspiracies$CRT3 <- ifelse(
  to_factor(conspiracies$W1_CRT3) == "47 days", 1, 0
)

conspiracies$CRT4 <- ifelse(
  to_factor(conspiracies$W1_CRT4) == "2nd", 1, 0
)

conspiracies$CRT5 <- ifelse(
  to_factor(conspiracies$W1_CRT5) == "8", 1, 0
)

conspiracies$CRT_test <- ifelse(
  to_factor(conspiracies$W1_CRT_test) == "None of them.", 1, 0
) # baseline = heard of some of them OR all of them
```

```{r}
# CRT
crt_keys <- list(crt = cs(CRT1,
                          CRT2,
                          CRT3,
                          CRT4, 
                          CRT5
                          ))

crt_test <- scoreItems(crt_keys, conspiracies, min = 0, max = 1)
head(crt_test$scores)
summary(crt_test$alpha)  # Scale alpha
conspiracies$crt <- rescale01(crt_test$scores, na.rm = TRUE)
conspiracies$crt <- c(conspiracies$crt)  # Ensure variable is numeric and not matrix class

describe(conspiracies$crt)
```


```{r}
# do CRT scores come from different distributions
# dependent on whether they've seen the test

conspiracies %>% 
  group_by(CRT_test) %>% 
  summarise(
    mean_crt = mean(crt),
    median_crt = median(crt),
    std_crt = sd(crt)
  )

kruskal.test(crt ~ CRT_test, data = conspiracies)
```

```{r}
# renaming trust in science
conspiracies <- conspiracies %>% 
  rename(distrust_science = W2_Trust_Body6)
```


```{r}
# rescaling the remaing numeric variables
numerics <- c("W1_Conspiracy_Total","W2_Paranoia_Total",
              "W2_Internal_Total","W2_Chance_Total","W2_PO_Total",
              "W2_DAI_Total","W2_IOU_Total", "W2_INFO_5",
              "W2_INFO_9","distrust_science","W1_Income_2019")

conspiracies[numerics] <- conspiracies[numerics] %>% 
  map_df(rescale01, na.rm = TRUE)
```


```{r}
# creating scaled versions of each conspiracy belief
conspiracies$conspiracy1_sc <- rescale01(
  conspiracies$W2_Conspiracy_Theory1, na.rm = TRUE
)

conspiracies$conspiracy2_sc <- rescale01(
  conspiracies$W2_Conspiracy_Theory2, na.rm = TRUE
)

conspiracies$conspiracy3_sc <- rescale01(
  conspiracies$W2_Conspiracy_Theory3, na.rm = TRUE
)

conspiracies$conspiracy4_sc <- rescale01(
  conspiracies$W2_Conspiracy_Theory4, na.rm = TRUE
)

conspiracies$conspiracy5_sc <- rescale01(
  conspiracies$W2_Conspiracy_Theory5, na.rm = TRUE
)
```


## Distribution of variables

A for loop to look at distribution of potential independent variables (numeric only).  

```{r}
plot_vars <- conspiracies %>% 
  dplyr::select(
    one_of(numerics),nat,RWA,SDO,threat,right,soc_con,fis_con
    ) %>%
  names()

for(i in seq_along(plot_vars)){
  
  x1 <- conspiracies[plot_vars][i] %>% as_vector()
  
  print(
    ggplot(data = NULL, aes(x = x1)) +
      geom_vline(aes(xintercept = mean(x1, na.rm =TRUE)), 
                 colour = "black",
                 linetype = "dashed") +
      geom_vline(aes(xintercept = median(x1, na.rm =TRUE)), 
                 colour = "red",
                 linetype = "dashed") +
      geom_density(fill = "lightblue", alpha = 0.7) +
      labs(x = plot_vars[i],
           caption = "Black = Mean, Red = Median")  
  )
  
}
```


# Principal Components Analysis - PCA

```{r}
# pca on conspiracy theory variables
pca_df <- conspiracies %>% 
  dplyr::select(W2_Conspiracy_Theory1:W2_Conspiracy_Theory5)

pca_fit <- prcomp(pca_df,scale = TRUE)
```

```{r}
# looking at biplots for components 1:4
biplot(pca_fit,
       col = c("lightgrey","red"))

biplot(pca_fit, choices = 3:4,
       col = c("lightgrey","red"))

pca_fit$rotation[,1:4]

components <- pca_fit$x[,1:4] %>% as_tibble()
```

First four principal components are as follows:  
1. general conspiracy ideation, with belief in 5G, 'it's no worse than flu' and vitamin C treatment highly loaded to this component, and belief in Chinese lab less so  
2. disbelief in Chinese meat market origin, with mild positive loading for Chinese lab origin  
3. strong conspiracy ideation (non-nationalistic), strong loading for belig 5g, 'it's no worse than flu' and vitamin C treatment, with negative loading for both Chinese lab origin and Chinese meat market  
4. strong loading for belief in 5G conspiracy and vitamin C treatment, but strong negative loading for belief 'it's no worse than flu'  


```{r}
pc <- cbind(conspiracies,components)

pc <- pc %>% 
  mutate(
    pc1_ihs = asinh(PC1)
  )

pc %>% 
  ggplot(aes(x = pc1_ihs)) +
  geom_density() +
  labs(x = "Principal Component 1 (IHS)")

pc %>% 
  ggplot(aes(x = PC2)) +
  geom_density() +
  labs(x = "Principal Component 2")

pc %>% 
  ggplot(aes(x = PC3)) +
  geom_density() +
  labs(x = "Principal Component 3")

pc %>% 
  ggplot(aes(x = PC4)) +
  geom_density()  +
  labs(x = "Principal Component 4")
```

Principal components 1 to 3 explain most of the variation in the data.  

```{r}
# modelling principal components against general conspiracy ideation
conspiracy_mod <- lm(W1_Conspiracy_Total ~ pc1_ihs + PC2 + PC3 + PC4,
                     data = pc)

par(mfrow = c(2,2))
plot(conspiracy_mod)

summ(conspiracy_mod, vifs = TRUE)

source("diagnostic_plots.R")
```

Only principal components 1 and 3 associated with general conspiracy ideation.  


# Modelling for belief in Chinese lab origin

## DV Chinese lab conspiracy - singular IV models

```{r}
sdo_lab <- lm(conspiracy1_sc ~ SDO,
              data = conspiracies)

summ(sdo_lab)
```

```{r}
rwa_lab <- lm(conspiracy1_sc ~ RWA,
              data = conspiracies)

summ(rwa_lab)
```

```{r}
mid_news_lab <- lm(conspiracy1_sc ~ mid_level_news,
              data = conspiracies)

summ(mid_news_lab)
```

```{r}
social_m_lab <- lm(conspiracy1_sc ~ W2_INFO_5,
              data = conspiracies)

summ(social_m_lab)
```

## DV Chinese lab conspiracy - socio-economic variables

```{r}
se_lab <- lm(conspiracy1_sc ~ W2_Gender_binary +
               W1_Education_binary +
               W1_Income_2019 +
               age_sc,
              data = conspiracies)

summary(se_lab)$adj.r.squared
AIC(se_lab)
```

## DV Chinese lab conspiracy - socio-economic variables + political/media

```{r}
se_pol_lab <- update(se_lab, ~ . +
                   #political and media variables
                   right +
                   soc_con +
                   fis_con +
                   nat +
                   distrust_science + #distrust of scientists
                   red_top_tabloid + 
                   mid_level_news + 
                   elite_news + 
                   W2_INFO_5 + #social media
                   W2_INFO_9 #family and friends
                 )

summary(se_pol_lab)$adj.r.squared
AIC(se_pol_lab)
```

## DV Chinese lab conspiracy - socio-economic variables + political/media + pol-psych

```{r}
se_polpsych_lab <- update(se_pol_lab, ~ . +
                        #political-psychology variables
                        SDO +
                        RWA +
                        W2_DAI_Total +
                        W2_IOU_Total +
                        W2_Paranoia_Total)

summary(se_polpsych_lab)$adj.r.squared
AIC(se_polpsych_lab)
car::vif(se_polpsych_lab)
```

Looking at mulitcollinearity below for the following variables: 

* right  
* soc_con  
* fis_con  

```{r}
# looking for potential multicollinearity with right
cor_mat <- model.matrix(se_polpsych_lab) %>% as.data.frame()

cor_vec <- rep(NA,ncol(cor_mat))
for(i in seq_along(cor_mat)){
  cor_vec[i] <- cor(cor_mat$right,cor_mat[,i])
}

tibble(cor_vec,
       names(cor_mat)) %>% 
  arrange(desc(cor_vec))
```

Fiscal conservatism positively correlated with right-left scale.  

```{r}
# looking for multicollinearity with soc_con
cor_vec2 <- rep(NA,ncol(cor_mat))
for(i in seq_along(cor_mat)){
  cor_vec2[i] <- cor(cor_mat$soc_con,cor_mat[,i])
}

tibble(cor_vec2,
       names(cor_mat)) %>% 
  arrange(desc(cor_vec2))
```

Fiscal conservatism, right-wing scale and RWA correlated with soc_con.  

```{r}
# looking for multicollinearity with fis_con
cor_vec3 <- rep(NA,ncol(cor_mat))
for(i in seq_along(cor_mat)){
  cor_vec3[i] <- cor(cor_mat$fis_con,cor_mat[,i])
}

tibble(cor_vec3,
       names(cor_mat)) %>% 
  arrange(desc(cor_vec3))
```

Right, soc_con correlated with fis_con.  

Potential multicollinearity between right, soc_con and fis_con. From hereon, fis_con is included in the models, as of the three, it shows the least positive correlation between SDO and RWA.  

## DV Chinese lab belief - model above minus the aforementioned variables

```{r}
se_polpsych_lab_2 <- lm(conspiracy1_sc ~
                        
                        #socio-economic variables
                        W2_Gender_binary +
                        W1_Education_binary +
                        W1_Income_2019 +
                        age_sc +
                        
                        #political and media variables
                        fis_con +
                        nat +
                        distrust_science +
                        red_top_tabloid + 
                        mid_level_news + 
                        elite_news + 
                        W2_INFO_5 + #social media
                        W2_INFO_9 + #family and friends
                     
                        #political-psychology variables
                        SDO +
                        RWA +
                        W2_DAI_Total +
                        W2_IOU_Total +
                        W2_Paranoia_Total,
                      data = conspiracies)

summary(se_polpsych_lab_2)$adj.r.squared
AIC(se_polpsych_lab_2)
car::vif(se_polpsych_lab_2)
```

All VIFs now below 2.  

## DV Chinese lab conspiracy - socio-economic variables + political/media + pol-psych + covid-threat + CRT

```{r}
multi_lab <- update(se_polpsych_lab_2, ~ . +
                  #covid-anxety
                  threat +
                  
                  #CRT
                  crt +
                  CRT_test)

summary(multi_lab)$adj.r.squared
AIC(multi_lab)
```

## DV Chinese lab conspiracy - full model incl. conspiracy ideation

```{r}
full_lab <- update(multi_lab, ~ . + 
                  #conspiracies
                  W1_Conspiracy_Total +
                  conspiracy2_sc +
                  conspiracy3_sc)

summary(full_lab)$adj.r.squared
AIC(full_lab)
```



# Modelling for belief in 5G origin conspiracy

## Plots of DV, incl. inverse hyperbolic sine transformation

```{r}
# functions for IHS transformation
ihs <- function(x, theta){  # IHS transformation
  asinh(theta * x)/theta
}

ihs_loglik <- function(theta,x){
  
  ihs <- function(x, theta){  # function to IHS transform
    asinh(theta * x)/theta
  }
  
  n <- length(x)
  xt <- ihs(x, theta)
  
  log_lik <- -n*log(sum((xt - mean(xt))^2))- sum(log(1+theta^2*x^2))
  return(log_lik)
}     


# alternative using shapiro-wik test
shapiro_test_pvalue <- function(theta, x){ 
  x <- ihs(x, theta) 
  shapiro.test(x)$p.value 
}
```

```{r}
best_theta <- optimize(shapiro_test_pvalue, 
                       lower = 0.00001, upper = 50,
                       x = conspiracies$W2_Conspiracy_Theory3, 
                       maximum = TRUE)$maximum
best_theta
```


```{r}
conspiracies %>% 
  ggplot(aes(x = W2_Conspiracy_Theory3)) +
  geom_histogram(colour = "darkgrey", fill = "lightblue")

conspiracies <- conspiracies %>% 
  mutate(w2_conspiracy3_ihs = ihs(W2_Conspiracy_Theory3, best_theta))

conspiracies %>% 
  ggplot(aes(x = w2_conspiracy3_ihs)) +
  geom_histogram(colour = "darkgrey", fill = "lightblue")
```


## DV 5G conspiracy - singular IV models

```{r}
sdo_5g <- lm(conspiracy3_sc ~ SDO,
              data = conspiracies)

summ(sdo_5g)
```


```{r}
rwa_5g <- lm(conspiracy3_sc ~ RWA,
              data = conspiracies)

summ(rwa_5g)
```

```{r}
mid_news_5g <- lm(conspiracy3_sc ~ mid_level_news,
              data = conspiracies)

summ(mid_news_5g)
```

```{r}
social_m_5g <- lm(conspiracy3_sc ~ W2_INFO_5,
              data = conspiracies)

summ(social_m_5g)
```

## DV 5G conspiracy - socio-economic variables

```{r}
se_5g <- lm(conspiracy3_sc ~ W2_Gender_binary +
               W1_Education_binary +
               W1_Income_2019 +
               age_sc,
              data = conspiracies)

#function for adj.r.squared
adj_rsq <- function(mod){
  out <- summary(mod)$adj.r.squared
  return(out)
}

adj_rsq(se_5g)
AIC(se_5g)
```

## DV 5G conspiracy - socio-economic variables + political/media

As with modelling above, fis_con is included instead of soc_con and right to avoid multicollinearity problem.  

```{r}
se_pol_5g <- update(se_5g, ~ . +
                   #political and media variables
                   fis_con +
                   nat +
                   distrust_science + 
                   red_top_tabloid + 
                   mid_level_news + 
                   elite_news + 
                   W2_INFO_5 + #social media
                   W2_INFO_9) # family and friends

adj_rsq(se_pol_5g)
AIC(se_pol_5g)
```


## DV 5G conspiracy - socio-economic variables + political/media + pol-psych

```{r}
se_polpsych_5g <- update(se_pol_5g, ~ . +
                        #political-psychology variables
                        SDO +
                        RWA +
                        W2_DAI_Total +
                        W2_IOU_Total +
                        W2_Paranoia_Total)

adj_rsq(se_polpsych_5g)
AIC(se_polpsych_5g)
```

## DV 5G conspiracy - socio-economic variables + political/media + pol-psych + covid-threat

```{r}
multi_5g <- update(se_polpsych_5g, ~ . +
                  #covid-anxiety
                  threat +
                 
                  # crt
                  crt +
                  CRT_test)

adj_rsq(multi_5g)
AIC(multi_5g)
```

## DV 5G conspiracy - socio-economic variables + political/media + pol-psych + covid-threat and CRT + conspiracies


```{r}
full_5g <- update(multi_5g, ~ . +
                #conspiracies
                W1_Conspiracy_Total +
                conspiracy1_sc +
                conspiracy2_sc)

adj_rsq(full_5g)
AIC(full_5g)
```

## DV 5G IHS conspiracy - singular IV models

```{r}
sdo_5g_ihs <- lm(w2_conspiracy3_ihs ~ SDO,
              data = conspiracies)

summ(sdo_5g_ihs)
```


```{r}
rwa_5g_ihs <- lm(w2_conspiracy3_ihs ~ RWA,
              data = conspiracies)

summ(rwa_5g_ihs)
```

```{r}
mid_news_5g_ihs <- lm(w2_conspiracy3_ihs ~ mid_level_news,
              data = conspiracies)

summ(mid_news_5g_ihs)
```

```{r}
social_m_5g_ihs <- lm(w2_conspiracy3_ihs ~ W2_INFO_5,
              data = conspiracies)

summ(social_m_5g_ihs)
```

## DV 5G IHS conspiracy - socio-economic variables

```{r}
se_5g_ihs <- lm(w2_conspiracy3_ihs ~ W2_Gender_binary +
               W1_Education_binary +
               W1_Income_2019 +
               age_sc,
              data = conspiracies)

adj_rsq(se_5g_ihs)
AIC(se_5g_ihs)
```

## DV 5G IHS conspiracy - socio-economic variables + political/media

As with modelling above, fis_con is included instead of soc_con and right to avoid multicollinearity problem.  

```{r}
se_pol_5g_ihs <- update(se_5g_ihs, ~ . +
                   #political and media variables
                   fis_con +
                   nat +
                   distrust_science + 
                   red_top_tabloid + 
                   mid_level_news + 
                   elite_news + 
                   W2_INFO_5 + #social media
                   W2_INFO_9)

adj_rsq(se_pol_5g_ihs)
AIC(se_pol_5g_ihs)
```

## DV 5G IHS conspiracy - socio-economic variables + political/media + pol-psych

```{r}
se_polpsych_5g_ihs <- update(se_pol_5g_ihs, ~ . +
                        #political-psychology variables
                        SDO +
                        RWA +
                        W2_DAI_Total +
                        W2_IOU_Total +
                        W2_Paranoia_Total)

adj_rsq(se_polpsych_5g_ihs)
AIC(se_polpsych_5g_ihs)
```

## DV 5G IHS conspiracy - socio-economic variables + political/media + pol-psych + covid-threat

```{r}
multi_5g_ihs <- update(se_polpsych_5g_ihs, ~ . +
                  #covid-anxiety
                  threat +
                 
                  # crt
                  crt +
                  CRT_test)

adj_rsq(multi_5g_ihs)
AIC(multi_5g_ihs)
```

## DV 5G IHS conspiracy - socio-economic variables + political/media + pol-psych + covid-threat and CRT + conspiracies

```{r}
full_5g_ihs <- update(multi_5g_ihs, ~ . +
                #conspiracies
                W1_Conspiracy_Total +
                conspiracy1_sc +
                conspiracy2_sc)

adj_rsq(full_5g_ihs)
AIC(full_5g_ihs)
```


## DV 5G conspiracy poisson regression model

```{r}
conspiracies %>% 
  mutate(
    sdo_deciles = cut_number(SDO,10)
  ) %>%
  group_by(sdo_deciles) %>% 
  summarise(
    mean_5g = mean(W2_Conspiracy_Theory3),
    var_5g = sd(W2_Conspiracy_Theory3) ^ 2
  )

conspiracies %>% 
  mutate(
    social_media = cut_interval(W2_INFO_5,5)
  ) %>%
  group_by(social_media) %>% 
  summarise(
    mean_5g = mean(W2_Conspiracy_Theory3),
    var_5g = sd(W2_Conspiracy_Theory3) ^ 2
  )
```


The tables above suggest overdispersion of the data.  As a result, running quasipoisson models.    

```{r}
full_5g_poiss <- glm(W2_Conspiracy_Theory3 ~
                           #socio-economic variables
                           W2_Gender_binary +
                           W1_Education_binary +
                           W1_Income_2019 +
                           age_sc +
                           
                           #political and media variables
                           fis_con +
                           nat +
                           distrust_science + #distrust of scientists
                           red_top_tabloid + 
                           mid_level_news + 
                           elite_news + 
                           W2_INFO_5 + #social media
                           W2_INFO_9 + #family and friends
                           
                           #political-psychology variables
                           SDO +
                           RWA +
                           W2_DAI_Total +
                           W2_IOU_Total +
                           W2_Paranoia_Total +
                           
                           #covid-anxiety
                           threat +
                           
                           #crt
                           crt +
                           CRT_test +
                           
                           #conspiracies
                           W1_Conspiracy_Total +
                           conspiracy1_sc +
                           conspiracy2_sc,
                         family = "quasipoisson", data = conspiracies)

summ(full_5g_poiss)
```

# Modelling for belief in Chinese meat market origin

## DV Chinese meat market - singular IV models

```{r}
sdo_meat <- lm(conspiracy2_sc ~ SDO,
              data = conspiracies)

summ(sdo_meat)
```

```{r}
rwa_meat <- lm(conspiracy2_sc ~ RWA,
              data = conspiracies)

summ(rwa_meat)
```

```{r}
mid_news_meat <- lm(conspiracy2_sc ~ mid_level_news,
              data = conspiracies)

summ(mid_news_meat)
```

```{r}
social_m_meat <- lm(conspiracy2_sc ~ W2_INFO_5,
              data = conspiracies)

summ(social_m_meat)
```

## DV Chinese meat market belief - socio-economic variables

```{r}
se_meat <- lm(conspiracy2_sc ~ W2_Gender_binary +
               W1_Education_binary +
               W1_Income_2019 +
               age_sc,
              data = conspiracies)

adj_rsq(se_meat)
AIC(se_meat)
```

## DV Chinese meat market belief - socio-economic variables + political/media

```{r}
se_pol_meat <- update(se_meat, ~ . +
                   #political and media variables
                   fis_con +
                   nat +
                   distrust_science + 
                   red_top_tabloid + 
                   mid_level_news + 
                   elite_news + 
                   W2_INFO_5 + #social media
                   W2_INFO_9) #family and friends
                 
adj_rsq(se_pol_meat)
AIC(se_pol_meat)
```

## DV Chinese meat market belief - socio-economic variables + political/media + pol-psych

```{r}
se_polpsych_meat <- update(se_pol_meat, ~ . +
                        #political-psychology variables
                        SDO +
                        RWA +
                        W2_DAI_Total +
                        W2_IOU_Total +
                        W2_Paranoia_Total)

adj_rsq(se_polpsych_meat)
AIC(se_polpsych_meat)
```

## DV Chinese meat market belief - socio-economic variables + political/media + pol-psych + covid-threat + CRT

```{r}
multi_meat <- update(se_polpsych_meat, ~ . +
                  #covid-anxiety
                  threat +
                  
                  #CRT
                  crt +
                  CRT_test)

adj_rsq(multi_meat)
AIC(multi_meat)
```


## DV Chinese meat market belief - full model incl. conspiracy ideation

```{r}
full_meat <- update(multi_meat, ~ . +
                  #conspiracies
                  W1_Conspiracy_Total +
                  conspiracy1_sc +
                  conspiracy3_sc)

adj_rsq(full_meat)
AIC(full_meat)
```

# Summary of final models

```{r}
# setting up groups -----------------------------------------
accuracy <- c("crt","CRT_test","W1_Education_binary1")
names(accuracy) <- c("CRT","CRT pre-exposure","Education")

motivation <- c("threat","W2_DAI_Total","distrust_science",
                "fis_con","W2_IOU_Total",
                "nat","W2_Paranoia_Total",
                "RWA","SDO")
names(motivation) <- c("COVID-19 anxiety","Death anxiety",
                       "Distrust scientists","Fiscal conservatism",
                       "IOU","Nationalism","Paranoia",
                       "RWA","SDO")

inform <- c("W2_INFO_9","elite_news","mid_level_news",
            "red_top_tabloid","W2_INFO_5")
names(inform) <- c("Family and friends","News: elite",
                   "News: mid-level","News: tabloid","Social media")

conspiracy <- c("W1_Conspiracy_Total","conspiracy2_sc","conspiracy1_sc",
                "conspiracy3_sc")
names(conspiracy) <- c("Conspiracy ideation","Meat market belief",
                       "Wuhan lab belief","5G belief")
full_list <- c(accuracy, motivation, inform, conspiracy)
```

```{r}
# chinese lab figure 
plot_coefs(
  full_lab,
  coefs = full_list,
  groups = list(
    Accuracy = names(accuracy), 
    Motivation = names(motivation), 
    Information = names(inform), 
    Conspiracy = names(conspiracy)
  ),
  #facet.label.pos = "left",
  facet.cols = 2
) +
  labs(x = "Estimate: Wuhan laboratory belief") +
  theme(strip.text.x = element_text(size = 8),
        axis.title.x = element_text(size = 10),
        axis.text.y = element_text(hjust = 0))

summ(full_lab, vifs = TRUE)
par(mfrow = c(2,2))
plot(full_lab)
```


```{r}
# 5G belief - full set of variables, raw data is DV
plot_coefs(
  full_5g,
  coefs = full_list,
  groups = list(
    Accuracy = names(accuracy), 
    Motivation = names(motivation), 
    Information = names(inform), 
    Conspiracy = names(conspiracy)
  ),
  #facet.label.pos = "left",
  facet.cols = 2
) +
  labs(x = "Estimate: 5G belief") +
  theme(strip.text.x = element_text(size = 8),
        axis.title.x = element_text(size = 10),
        axis.text.y = element_text(hjust = 1))

summ(full_5g, vifs = TRUE)
par(mfrow = c(2,2))
plot(full_5g)
```

```{r}
# plot for IHS model
plot_coefs(
  full_5g_ihs,
  coefs = full_list,
  groups = list(
    Accuracy = names(accuracy), 
    Motivation = names(motivation), 
    Information = names(inform), 
    Conspiracy = names(conspiracy)
  ),
  #facet.label.pos = "left",
  facet.cols = 2
) +
  labs(x = "Estimate: 5G belief (IHS)") +
  theme(strip.text.x = element_text(size = 8),
        axis.title.x = element_text(size = 10),
        axis.text.y = element_text(hjust = 1))

```


```{r}
# 5G belief - full set of variables and poisson
plot_coefs(
  full_5g_poiss,
  coefs = full_list,
  groups = list(
    Accuracy = names(accuracy), 
    Motivation = names(motivation), 
    Information = names(inform), 
    Conspiracy = names(conspiracy)
  ),
  #facet.label.pos = "left",
  facet.cols = 2
) +
  labs(x = "Estimate: 5G belief (poisson)") +
  theme(strip.text.x = element_text(size = 8),
        axis.title.x = element_text(size = 10),
        axis.text.y = element_text(hjust = 1))
```


```{r}
# Chinese meat market model - full set of variables
plot_coefs(
  full_meat,
  coefs = full_list,
  groups = list(
    Accuracy = names(accuracy), 
    Motivation = names(motivation), 
    Information = names(inform), 
    Conspiracy = names(conspiracy)
  ),
  #facet.label.pos = "left",
  facet.cols = 2
) +
  labs(x = "Estimate: Meat market belief") +
  theme(strip.text.x = element_text(size = 8),
        axis.title.x = element_text(size = 10),
        axis.text.y = element_text(hjust = 1))

summ(full_meat, vifs = TRUE)
par(mfrow = c(2,2))
plot(full_meat)
```

## Combined plot of models

```{r, message = FALSE, warning = FALSE}
model_vars <- full_list[c("CRT","Education",
                       "News: mid-level","News: tabloid",
                       "Social media",
                       "Family and friends",
                       "SDO","RWA")]

model_vars <- model_vars[sort(names(model_vars))]

plot_coefs(
  full_lab,full_5g,full_meat,
  model.names = c("Wuhan lab","5G","Meat market"),
  coefs = model_vars
  ) +
  labs(
    x = "Estimate: OLS model comparison"
  ) + 
  theme(legend.position = "top",
        legend.margin=margin(t = 0, b = 0, unit='cm'),
        axis.title.x = element_text(size = 10),
        axis.text.y = element_text(hjust = 1))
```


## Conspiracies and social distancing

```{r}
# loading package for multi nom
pacman::p_load(nnet)
```


```{r}
## making a dataset of variables included in the models above
## plus DV's for social distancing and vaccination

vars <- model.matrix(full_lab)[,-1] %>% as.data.frame() %>% names()
vars <- c(vars,"w2_conspiracy3_ihs","W2_Internal_Total",
          "W2_Chance_Total","W2_Conspiracy_Theory1",
          "W2_Conspiracy_Theory2","W2_Conspiracy_Theory3",
          "W2_Conspiracy_Theory4","W2_Conspiracy_Theory5",
          "conspiracy4_sc","conspiracy5_sc","conspiracy1_sc",
          "W2_PO_Total","pid","right","soc_con")
vars[1] <- str_sub(vars[1],1,str_length(vars[1])-1)
vars[2] <- str_sub(vars[2],1,str_length(vars[2])-1)

conspiracies2 <- conspiracies %>% 
  dplyr::select(one_of(vars)) %>% 
  na.omit()

conspiracies2 <- merge(
  conspiracies2,
  conspiracies %>% dplyr::select(pid,W2_SocialDistance10,
                                 W2_SocialDistance11,
                                 W2_SocialDistance12,
                                 W2_SocialDistance14,
                                 W2_C19_Vax_Self,
                                 W2_C19_Vax_Child),
  by = "pid", all.x = TRUE
)

```


```{r}
# social distance scale
sd_keys <- list(sd = cs(W2_SocialDistance10,
                        W2_SocialDistance11,
                        W2_SocialDistance12,
                        W2_SocialDistance14))

sd_test <- scoreItems(sd_keys, conspiracies2, min = 1, max = 5)
head(sd_test$scores)
summary(sd_test$alpha)  # Scale alpha
conspiracies2$social_distance <- rescale01(sd_test$scores, na.rm = TRUE)
conspiracies2$social_distance <- c(conspiracies2$social_distance)  # Ensure variable is numeric and not matrix class

describe(conspiracies2$social_distance)
ggplot(conspiracies2, aes(x = social_distance, y = ..density..)) +
  geom_histogram(binwidth = 0.1, colour = "black", fill = "lightblue")
```


```{r}
dist_full <- lm(social_distance ~ 
                  #socio-economic variables
                  W2_Gender_binary +
                  W1_Education_binary +
                  W1_Income_2019 +
                  age_sc +
                  
                  #political and media variables
                  fis_con +
                  nat +
                  distrust_science + 
                  red_top_tabloid + 
                  mid_level_news + 
                  elite_news +
                  W2_INFO_5 + #social media
                  W2_INFO_9 + #family and friends
                  
                  #political-psychology variables
                  SDO +
                  RWA +
                  W2_DAI_Total +
                  W2_IOU_Total +
                  W2_Paranoia_Total +
                  
                  #covid-anxiety
                  threat +
                 
                  #CRT
                  crt +
                  CRT_test +
                  
                  #conspiracies
                  W1_Conspiracy_Total +
                  conspiracy1_sc +
                  conspiracy2_sc +
                  conspiracy3_sc,
                data = conspiracies2)
```

```{r}
# social distance model plot
socio_dem <- c("age_sc","W2_Gender_binary2")
names(socio_dem) <- c("Age","Gender")
motivation2 <- motivation[c("COVID-19 anxiety","Death anxiety",
                            "Distrust scientists","IOU",
                            "Paranoia","RWA","SDO")]
inform2 <- inform["Family and friends"]

plot_coefs(
  dist_full,
  coefs = c(socio_dem,motivation2,inform2,conspiracy),
  groups = list(
    Demographic = names(socio_dem), 
    Motivation = names(motivation2), 
    Information = names(inform2), 
    Conspiracy = names(conspiracy)
  ),
  #facet.label.pos = "left",
  facet.cols = 2
) +
  labs(x = "Estimate: Social distancing") +
  theme(strip.text.x = element_text(size = 8),
        axis.title.x = element_text(size = 10),
        axis.text.y = element_text(hjust = 1))

par(mfrow = c(2,2))
plot(dist_full)
```


## Multinomial model for vaccine acceptance

```{r}
count(conspiracies2,sum()) %>%  mutate(`%` = n / sum(n))

vax_full <- multinom(W2_C19_Vax_Self ~ 
                  #socio-economic variables
                  W2_Gender_binary +
                  W1_Education_binary +
                  W1_Income_2019 +
                  age_sc +
                  
                  #political and media variables
                  fis_con +
                  nat +
                  distrust_science + 
                  red_top_tabloid + 
                  mid_level_news + 
                  elite_news +
                  W2_INFO_5 + #social media
                  W2_INFO_9 + #family and friends
                  
                  #political-psychology variables
                  SDO +
                  RWA +
                  W2_DAI_Total +
                  W2_IOU_Total +
                  W2_Paranoia_Total +
                  
                  #covid-anxiety
                  threat +
                 
                  #CRT
                  crt +
                  CRT_test +
                  
                  #conspiracies
                  W1_Conspiracy_Total +
                  conspiracy1_sc +
                  conspiracy2_sc +
                  conspiracy3_sc,
                data = conspiracies2)
```

```{r}
# functions to inspect multinom
z_score <- function(model){
  z <- summary(model)$coefficients/summary(model)$standard.errors
  return(z)
}

p_value <- function(model){
  z <- z_score(model)
  p <- (1 - pnorm(abs(z), 0, 1)) * 2
  return(p)
}
```

```{r}
p_value(vax_full)
```


```{r}
fuller_list <- c(full_list,socio_dem,"W1_Income_2019")
names(fuller_list) <- c(names(full_list),names(socio_dem),"Income")

vax_plots <- fuller_list[c("Age","Gender",
                        "Income","COVID-19 anxiety",
                        "Distrust scientists","Nationalism",
                        "RWA","SDO",
                        "Conspiracy ideation",
                        "Meat market belief",
                        "Wuhan lab belief",
                        "5G belief")]

tidies <- tidy(vax_full) %>%
  filter(term %in% vax_plots) %>% 
  mutate(
    odds_ratio = exp(estimate),
    conf.low = estimate - std.error * qnorm(0.975),
    conf.high = estimate + std.error * qnorm(0.975),
    conf.low.exp = exp(estimate - std.error * qnorm(0.975)),
    conf.high.exp = exp(estimate + std.error * qnorm(0.975)),
    y.level = fct_recode(as.factor(y.level),
                         "No" = "2",
                         "Maybe" = "3"),
    term = fct_rev(fct_drop(fct_relevel(term, vax_plots))),
    group_facet = ifelse(term %in% accuracy, 
                         "Accuracy",
                         ifelse(term %in% motivation, "Motivation",
                                ifelse(term %in% conspiracy, "Conspiracy",
                                       "Demographic"))),
    term = fct_recode(term,
                      "Age" = "age_sc",
                      "Gender" = "W2_Gender_binary2",
                      "Income" = "W1_Income_2019",
                      "COVID-19 anxiety" = "threat",
                      "Distrust scientists" = "distrust_science",
                      "Nationalism" = "nat",
                      "RWA" = "RWA",
                      "SDO" = "SDO",
                      "Conspiracy ideation" = "W1_Conspiracy_Total",
                      "Meat market belief" = "conspiracy2_sc",
                      "Wuhan lab belief" = "conspiracy1_sc",
                      "5G belief" = "conspiracy3_sc")
    ) %>%
  rename(Level = y.level)  

ggplot(data = tidies, 
       aes(y = term, 
           x = estimate, xmin = conf.low,
           xmax = conf.high, colour = Level)) + 
  geom_vline(xintercept = 0, linetype = 2, size = .25) +
  ggstance::geom_linerangeh(
    aes(y = term, xmin = conf.low,
        xmax = conf.high, colour = Level),
    position = ggstance::position_dodgev(height = 0.62), size = 0.8) +
  geom_point(
    aes(y = term, 
        x = estimate, colour = Level, shape = Level),
    position = ggstance::position_dodgev(height = 0.62),
    fill = "white", size = 3, stroke = 1, show.legend = TRUE) +
  scale_colour_manual(values = get_colors("CUD Bright",num.colors = 2)) +
  theme_nice(legend.pos = "right") +
  scale_shape_manual(values = c(21,22)) +
  drop_y_gridlines() +
  facet_wrap(~group_facet, ncol = 1, scales = "free_y",
             strip.position = "left") +
  theme(axis.title.y = element_blank(),
        legend.margin=margin(t = 0, b = 0, unit='cm'),
        axis.title.x = element_text(size = 10),
        axis.text.y = element_text(size = 10,
                                   hjust = 1),
        panel.grid.major.x = element_line(linetype = "solid"),
        strip.text.x = element_text(size = 8),
        legend.position = "top") +
  labs(
    x = "Estimate: Vaccine acceptance"
  ) 
```

## Table summarising variables

```{r}
all_vars <- model.matrix(dist_full)[,-1] %>% as_tibble()
var_summaries <- tibble(
  variable = names(all_vars),
  mean = all_vars %>% map_dbl(mean, na.rm = TRUE),
  sd = all_vars %>% map_dbl(sd, na.rm = TRUE)
)

#write.csv(var_summaries,"variable_summaries.csv")
```

## Correlation Matrix

```{r}
even_fuller_list <- c(
  fuller_list %>%
    str_replace("W1_Education_binary1","W1_Education_binary") %>%
    str_replace("W2_Gender_binary2","W2_Gender_binary"),
  "soc_con","right","social_distance","W2_C19_Vax_Self")

names(even_fuller_list) <- c(names(fuller_list),"Social conservatism",
                             "Right-left scale", 
                             "Social distancing motivation",
                             "Vaccination attitudes")

even_fuller_list <- sort(even_fuller_list)

cor_df <- conspiracies2 %>% 
  dplyr::select(one_of(even_fuller_list)) %>% 
  na.omit()

make_dbl <- c("W2_C19_Vax_Self","W2_Gender_binary","W1_Education_binary")

cor_df[make_dbl] <- cor_df[make_dbl] %>% 
  map_df(as.numeric)

cor_df %>% 
  map_chr(class)

# function to get lower triangle in correlation matrix
get_lower_tri <- function(df){
  cormat <- cor(df)
  cormat[upper.tri(cormat)]<- NA
  return(cormat)
}

lower_tri <- get_lower_tri(cor_df)

var_1 <- sort(names(cor_df))

# plotting correlation matrix
cbind(
  lower_tri,
  var_1
) %>%
  as_tibble() %>%
  gather(var_2,correlation,age_sc:W2_Paranoia_Total, na.rm = T) %>%
  mutate(correlation = parse_number(correlation)) %>%
  arrange(var_1) %>%
  ggplot(aes(x = var_1, y = var_2, fill = correlation)) +
  geom_tile(colour = "white") +
  scale_fill_gradientn(breaks = c(-0.2,0,0.2,0.5),
                       colours = c("red","white",
                                   "lightblue",
                                   "dodgerblue4",
                                   "midnightblue")) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) +
  labs(x = NULL, y = NULL) +
  scale_x_discrete(labels = names(even_fuller_list)) +
  scale_y_discrete(labels = names(even_fuller_list))
```

```{r}
# table for correlation matrix
pacman::p_load(stargazer)

lower_tri <- lower_tri %>% as_tibble()

stargazer(lower_tri)


```



## Regression tables

```{r}

# setting up variable orders
to_plot <- c("age_sc","W1_Education_binary1","W2_Gender_binary2",
             "W1_Income_2019","elite_news","W2_INFO_9","mid_level_news",
             "W2_INFO_5","red_top_tabloid","threat","W2_DAI_Total",
             "distrust_science","fis_con","W2_IOU_Total",
             "nat","W2_Paranoia_Total",
             "RWA","SDO","crt","CRT_test","W1_Conspiracy_Total",
             "conspiracy1_sc","conspiracy2_sc","conspiracy3_sc")
names(to_plot) <- c("Age","Education","Gender","Income","Elite news",
              "Family and friends","Mid-level news","Social media",
              "Tabloid news","COVID-19 anxiety","Death anxiety",
              "Distrust scientists","Fiscal conservatism",
              "Intolerance of uncertainty","Nationalism","Paranoia","RWA",
              "SDO","CRT","CRT pre-exposure","Conspiracy ideation",
              "Wuhan lab belief","Meat market belief","5G belief")

to_plot <- to_plot[sort(names(to_plot))]
```


```{r, results='asis'}
stargazer(full_meat, full_lab, full_5g, full_5g_ihs, full_5g_poiss, 
          title="Table A2: Regression Results Origin Theory Belief",
          dep.var.labels=c("Meat market", "Wuhan lab","5G","5G","5G"),
          column.labels = c("OLS","OLS","OLS","OLS (IHS)","Poisson"),
          order = to_plot,
          covariate.labels = names(to_plot),
          #omit.stat=c("LL","ser","f","bic"),
          keep.stat = c("n","rsq","adj.rsq"),
          model.names = FALSE,
          single.row=TRUE,
          model.numbers = FALSE,
          align = TRUE,
          report = "vcs*",
          star.cutoffs = c(0.05, 0.01, 0.001),
          type = "html")
```


```{r, results = "asis"}
stargazer(dist_full, vax_full,
          title="Table A3: Public Health Measures Model Results",
          dep.var.labels=c("Social distancing (OLS)",
                           "Vaccine (multi logit)",
                           "Vaccine (multi logit)"),
          multicolumn = TRUE,
          column.labels = c(" ", "No", "Maybe"),
          model.names = FALSE,
          model.numbers = FALSE,
          order = to_plot,
          covariate.labels = names(to_plot),
          #omit.stat=c("LL","ser","f","bic"),
          keep.stat = c("n","rsq","adj.rsq","aic"),
          single.row=TRUE,
          align = TRUE,
          report = "vcs*",
          star.cutoffs = c(0.05, 0.01, 0.001),
          type = "html")
```


